## Bengali FAQ predefined Q/A RAG System

**Production-ready Bengali FAQ system with ultra-precision hybrid matching and cross-collection disambiguation.**

## тЪб Key Features

- **ЁЯОп Ultra-Precision Matching**: 90%+ accuracy with hybrid scoring (embeddings + n-grams + keywords + phrases)
- **ЁЯПЧя╕П File-as-Cluster Architecture**: Each FAQ file = separate ChromaDB collection for perfect isolation
- **ЁЯза Cross-Collection Disambiguation**: Authority scoring prevents Islamic vs Conventional banking confusion
- **тЪб Embedding Efficiency**: 1 API call per query (vs 11+ in naive implementations)
- **ЁЯМН Bengali Text Processing**: Advanced normalization and domain-specific phrase matching
- **ЁЯФА Multiple Interfaces**: REST API, batch processing, and interactive CLI


## ЁЯЪА Quick Start

### Prerequisites
- Python 3.12
- OpenAI API key
- Git

### Installation
```bash
# Clone the repository
git clone <repository>
cd deterministic-answer-rag-openai

# Install dependencies
pip install -r requirements.txt --no-deps

# Set your OpenAI API key
export OPENAI_API_KEY="your_api_key_here"
```

## ЁЯФз Three Ways to Use the System

### 1. ЁЯТм Interactive CLI Interface

**Best for**: Real-time testing, development, and exploring the system capabilities.

```bash
python interactive.py
```

**Features:**
- Real-time question answering
- Debug mode for detailed analysis
- System statistics display
- Bengali and English support

**Usage Examples:**
```bash
ЁЯФН Enter your query: ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗрж░ ржирзНржпрзВржирждржо ржХрж┐рж╕рзНрждрж┐рж░ ржкрж░рж┐ржорж╛ржг ржХржд?
тЬЕ MATCH FOUND (Confidence: 98.3%)
ЁЯУБ Source: yaqeen.txt
ЁЯЧВя╕П  Collection: faq_yaqeen
тЭУ Question: ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ ржмрж╛ рж▓рж╛ржЦржкрждрж┐ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗрж░ ржирзНржпрзВржирждржо ржХрж┐рж╕рзНрждрж┐рж░ ржкрж░рж┐ржорж╛ржг ржХржд?
ЁЯТм Answer: ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ ржмрж╛ рж▓рж╛ржЦржкрждрж┐ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗрж░ ржирзНржпрзВржирждржо ржХрж┐рж╕рзНрждрж┐рж░ ржкрж░рж┐ржорж╛ржг рзлрзжрзж ржЯрж╛ржХрж╛ред

# Available commands:
# - debug on/off    : Toggle debug mode
# - stats          : Show system statistics  
# - exit           : Quit the program
```

### 2. ЁЯМР REST API Server

**Best for**: Production deployments, web applications, and microservices integration.

#### Start the Server
```bash
# Default (localhost:5000)
python api_server.py

# Custom host and port
python api_server.py --host 0.0.0.0 --port 8000

# With debug mode
python api_server.py --debug
```

#### API Endpoints

**ЁЯУЦ Documentation**: Visit `http://localhost:5000/` for complete API docs

**1. Single Query - Retail Banking**
```bash
curl -X POST http://localhost:5000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ржПржоржЯрж┐ржмрж┐ ржЗржирзНрж╕ржкрж╛ржпрж╝рж╛рж░ ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржХрж┐ ржХрж┐ ржбржХрзБржорзЗржирзНржЯ рж▓рж╛ржЧрзЗ?",
    "debug": false
  }'
```

**Response:**
```json
{
  "query": "ржПржоржЯрж┐ржмрж┐ ржЗржирзНрж╕ржкрж╛ржпрж╝рж╛рж░ ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржХрж┐ ржХрж┐ ржбржХрзБржорзЗржирзНржЯ рж▓рж╛ржЧрзЗ?",
  "found": true,
  "confidence": 0.956,
  "matched_question": "ржЗржирзНрж╕ржкрж╛ржпрж╝рж╛рж░ ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржХрж┐ ржХрж┐ ржбржХрзБржорзЗржирзНржЯ рж▓рж╛ржЧрзЗ?",
  "answer": "ржЗржирзНрж╕ржкрж╛ржпрж╝рж╛рж░ ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржЬрж╛рждрзАржпрж╝ ржкрж░рж┐ржЪржпрж╝ржкрждрзНрж░, ржкрж╛рж╕ржкрзЛрж░рзНржЯ рж╕рж╛ржЗржЬ ржЫржмрж┐ ржПржмржВ ржирзНржпрзВржирждржо ржЬржорж╛рж░ ржкрж░рж┐ржорж╛ржг ржкрзНрж░ржпрж╝рзЛржЬржиред",
  "source": "retails_products.txt",
  "collection": "faq_retail",
  "timestamp": "2024-12-01T10:30:00"
}
```

**2. Single Query - Islamic Banking**
```bash
curl -X POST http://localhost:5000/api/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХржд?",
    "debug": true
  }'
```

**Response:**
```json
{
  "query": "ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХржд?",
  "found": true,
  "confidence": 0.892,
  "matched_question": "ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗ ржХрж┐ рж╣рж╛рж░рзЗ ржорзБржирж╛ржлрж╛ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝?",
  "answer": "ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗ ржмрж░рзНрждржорж╛ржирзЗ рзо% рж╣рж╛рж░рзЗ ржорзБржирж╛ржлрж╛ ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣ржпрж╝ред",
  "source": "yaqeen.txt",
  "collection": "faq_yaqeen",
  "timestamp": "2024-12-01T10:32:15",
  "debug": {
    "detected_collections": ["yaqeen"],
    "candidates": [
      {
        "question": "ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ рж╕рзЗржнрж┐ржВрж╕ рж╕рзНржХрж┐ржорзЗ ржХрж┐ рж╣рж╛рж░рзЗ ржорзБржирж╛ржлрж╛ ржжрзЗржУржпрж╝рж╛ рж╣ржпрж╝?",
        "score": 0.892,
        "collection": "faq_yaqeen"
      },
      {
        "question": "ржЗржпрж╝рж╛ржХрж┐ржи рж╕ржЮрзНржЪржпрж╝ рж╣рж┐рж╕рж╛ржмрзЗ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХржд?",
        "score": 0.756,
        "collection": "faq_yaqeen"
      }
    ],
    "threshold": 0.9
  }
}
```

**3. Batch Processing**
```bash
curl -X POST http://localhost:5000/api/batch \
  -H "Content-Type: application/json" \
  -d '{
    "queries": [
      "ржЗржпрж╝рж╛ржХрж┐ржи ржПржХрж╛ржЙржирзНржЯ ржХрж┐?",
      "ржПрж╕ржПржоржЗ рж▓рзЛржирзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХржд?",
      "ржХрж╛рж░рзНржб ржмрзНрж▓ржХ ржХрж░рждрзЗ ржЪрж╛ржЗ",
      "ржорж╣рж┐рж▓рж╛ржжрзЗрж░ ржЬржирзНржп ржХрж┐ ржмрж┐рж╢рзЗрж╖ рж╕рзБржмрж┐ржзрж╛ ржЖржЫрзЗ?"
    ],
    "debug": false
  }'
```

**Response:**
```json
{
  "metadata": {
    "total_queries": 4,
    "processed_queries": 4,
    "matched_count": 3,
    "match_rate": 75.0,
    "timestamp": "2024-12-01T10:35:42"
  },
  "results": [
    {
      "query_id": 1,
      "query": "ржЗржпрж╝рж╛ржХрж┐ржи ржПржХрж╛ржЙржирзНржЯ ржХрж┐?",
      "found": true,
      "confidence": 0.945,
      "matched_question": "ржЗржпрж╝рж╛ржХрж┐ржи ржПржХрж╛ржЙржирзНржЯ ржХрзА?",
      "answer": "ржЗржпрж╝рж╛ржХрж┐ржи ржПржХрж╛ржЙржирзНржЯ ржПржХржЯрж┐ ржЗрж╕рж▓рж╛ржорж┐ржХ рж╕ржЮрзНржЪржпрж╝ рж╣рж┐рж╕рж╛ржм...",
      "source": "yaqeen.txt",
      "collection": "faq_yaqeen"
    },
    {
      "query_id": 2,
      "query": "ржПрж╕ржПржоржЗ рж▓рзЛржирзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХржд?",
      "found": true,
      "confidence": 0.887,
      "matched_question": "ржПрж╕ржПржоржЗ рж▓рзЛржирзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ ржХрзЗржоржи?",
      "answer": "ржПрж╕ржПржоржЗ рж▓рзЛржирзЗрж░ рж╕рзБржжрзЗрж░ рж╣рж╛рж░ рззрзи% ржерзЗржХрзЗ рззрзо% ржкрж░рзНржпржирзНржд...",
      "source": "sme_banking.txt",
      "collection": "faq_sme"
    },
    {
      "query_id": 3,
      "query": "ржХрж╛рж░рзНржб ржмрзНрж▓ржХ ржХрж░рждрзЗ ржЪрж╛ржЗ",
      "found": true,
      "confidence": 0.923,
      "matched_question": "ржХрж╛рж░рзНржб ржмрзНрж▓ржХ ржХрж░рж╛рж░ ржирж┐ржпрж╝ржо ржХрж┐?",
      "answer": "ржХрж╛рж░рзНржб ржмрзНрж▓ржХ ржХрж░рждрзЗ рззрзмрзирзкрзн ржиржорзНржмрж░рзЗ ржХрж▓ ржХрж░рзБржи...",
      "source": "card_faqs.txt",
      "collection": "faq_card"
    },
    {
      "query_id": 4,
      "query": "ржорж╣рж┐рж▓рж╛ржжрзЗрж░ ржЬржирзНржп ржХрж┐ ржмрж┐рж╢рзЗрж╖ рж╕рзБржмрж┐ржзрж╛ ржЖржЫрзЗ?",
      "found": false,
      "confidence": 0.654,
      "message": "ржжрзБржГржЦрж┐ржд, ржЖржорж┐ ржЖржкржирж╛рж░ ржкрзНрж░рж╢рзНржирзЗрж░ ржЙрждрзНрждрж░ ржЦрзБржБржЬрзЗ ржкрж╛ржЗржирж┐ред"
    }
  ]
}
```

**4. Health Check**
```bash
curl http://localhost:5000/api/health
```

**5. System Statistics**
```bash
curl http://localhost:5000/api/stats
```

### 3. ЁЯУК Batch Processor

**Best for**: Processing large volumes of queries, testing, and performance analysis.

#### Basic Usage
```bash
# Process queries from input.txt
python batch_processor.py input.txt

# Specify custom output file
python batch_processor.py input.txt -o my_results.json

# Enable debug mode
python batch_processor.py input.txt --debug

# Show system stats before processing
python batch_processor.py input.txt --stats
```

#### Input File Format
Create a text file with one query per line:

**input.txt:**
```
ржорж╣рж┐рж▓рж╛ ржжрзЗрж░ ржЬржирзНржп ржХрж┐ ржПрж╕ржПржоржЗ ржПржХрж╛ржЙржирзНржЯ ржЦрзЛрж▓рж╛ ржпрж╛ржпрж╝?
ржПрж╕ржПржоржЗ ржкрж┐ржЖрж░ржП ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржХрж┐ ржбржХрзБржорзЗржирзНржЯрж╕ рж▓рж╛ржЧржмрзЗ?
ржХрж┐ ржХрж┐ ржзрж░ржгрзЗрж░ ржПрж╕ржПржоржЗ ржПржХрж╛ржЙржирзНржЯ ржУржкрзЗржи ржХрж░рж╛ ржпрж╛ржпрж╝?
ржПржоржЯрж┐ржмрж┐ ржмрзБржирж┐ржпрж╝рж╛ржж рж╕ржорзНржкрж░рзНржХрзЗ ржЬрж╛ржирждрзЗ ржЪрж╛ржЗред
ржЗржпрж╝рж╛ржХрж┐ржи ржЕржШржирж┐ржпрж╝рж╛ ржХрж┐?
```

#### Output Example
The processor generates a JSON file with detailed results:

```json
{
  "metadata": {
    "input_file": "input.txt",
    "output_file": "batch_results_20241201_143022.json",
    "processed_at": "2024-12-01T14:30:22",
    "total_queries": 5,
    "matched_count": 4,
    "match_rate": 80.0,
    "system_mode": "embedding_mode"
  },
  "results": [
    {
      "query_id": 1,
      "query": "ржорж╣рж┐рж▓рж╛ ржжрзЗрж░ ржЬржирзНржп ржХрж┐ ржПрж╕ржПржоржЗ ржПржХрж╛ржЙржирзНржЯ ржЦрзЛрж▓рж╛ ржпрж╛ржпрж╝?",
      "found": true,
      "confidence": 0.923,
      "matched_question": "ржорж╣рж┐рж▓рж╛ржжрзЗрж░ ржЬржирзНржп ржХрж┐ ржПрж╕ржПржоржЗ ржПржХрж╛ржЙржирзНржЯ ржЦрзЛрж▓рж╛ ржпрж╛ржпрж╝?",
      "answer": "рж╣рзНржпрж╛ржБ, ржорж╣рж┐рж▓рж╛рж░рж╛ ржПрж╕ржПржоржЗ ржПржХрж╛ржЙржирзНржЯ ржЦрзБрж▓рждрзЗ ржкрж╛рж░рзЗржи...",
      "source": "sme_banking.txt",
      "collection": "faq_sme"
    }
  ]
}
```

## ЁЯФз Command Line Options

### Interactive CLI
```bash
python interactive.py
# No command line options - all controls are interactive
```

### API Server
```bash
python api_server.py [options]

Options:
  --host HOST      Host to bind to (default: 0.0.0.0)
  --port PORT      Port to bind to (default: 5000)  
  --debug          Run in debug mode
```

### Batch Processor
```bash
python batch_processor.py input_file [options]

Arguments:
  input_file       Input text file with queries (one per line)

Options:
  -o, --output     Output JSON file for results
  -d, --debug      Include debug information
  --stats          Show system statistics before processing
```

## ЁЯПЧя╕П Architecture

### File-as-Cluster System
```
faq_data/
тФЬтФАтФА yaqeen.txt          тЖТ faq_yaqeen collection (Islamic banking)
тФЬтФАтФА retails_products.txt тЖТ faq_retail collection (Conventional)
тФЬтФАтФА sme_banking.txt     тЖТ faq_sme collection 
тФЬтФАтФА card_faqs.txt       тЖТ faq_card collection
тФФтФАтФА ...                 тЖТ 9 total collections
```

### Ultra-Precision Matching Pipeline
```
Query тЖТ Prime Word Routing тЖТ Embedding Search тЖТ Hybrid Enhancement тЖТ 
Cross-Collection Disambiguation тЖТ Authority Scoring тЖТ Best Match
```

## ЁЯЫая╕П Troubleshooting

### Common Issues

**1. Service Not Initialized**
```bash
тЭМ FAQ Service not initialized!
```
**Solution:** Check that FAQ files exist in `faq_data/` directory and OpenAI API key is set.

**2. No OpenAI API Key**
```bash
тЪая╕П Running in TEST MODE (no embeddings)
```
**Solution:** Set environment variable: `export OPENAI_API_KEY="your_key"`

**3. Port Already in Use (API Server)**
```bash
OSError: [Errno 98] Address already in use
```
**Solution:** Use a different port: `python api_server.py --port 8080`

**4. Empty Results**
```bash
тЭМ No queries found in input file
```
**Solution:** Ensure input file has one query per line and is UTF-8 encoded.

### Debug Mode

All interfaces support debug mode for detailed analysis:

- **Interactive**: Type `debug on`
- **API**: Set `"debug": true` in JSON requests  
- **Batch**: Use `--debug` flag

Debug output includes:
- Detected collections
- Candidate matches with scores
- Confidence thresholds
- Hybrid matching details

## ЁЯФз Core Components

| File | Purpose |
|------|---------|
| `faq_service.py` | Main service with routing and search logic |
| `hybrid_matcher.py` | Ultra-precision matching algorithms |
| `config.json` | System configuration |
| `api_server.py` | REST API interface |
| `batch_processor.py` | Batch processing interface |
| `interactive.py` | Interactive CLI interface |

## ЁЯОп Technical Highlights

### Ultra-Precision Matching
- **Collection-specific phrase libraries**: Islamic vs Conventional banking terms
- **Keyword expansion**: `"рж▓рж╛ржЦржкрждрж┐"` тЖТ `"ржПржоржЯрж┐ржмрж┐ рж▓рж╛ржЦржкрждрж┐"` for retail collection
- **N-gram weighting**: Collection-aware bigram/trigram importance
- **Sequential pattern recognition**: Word order significance
- **Negative keyword penalties**: Prevents wrong collection matches

### Embedding Efficiency
- **Query embedding caching**: Create once, reuse across all collections
- **Smart routing**: Prime word detection тЖТ targeted search тЖТ fallback to all
- **Batch optimization**: 91% reduction in API calls

### Cross-Collection Disambiguation
- **Authority scoring**: Domain expertise weighted by intent
- **Dynamic thresholds**: Adjust confidence based on ambiguity
- **Intent detection**: Islamic vs Conventional banking classification

## тЪЩя╕П Configuration

The system uses `config.json` for all configuration settings. Edit this file to customize:

```json
{
  "models": {
    "embedding_model": "text-embedding-3-large"
  },
  "system": {
    "confidence_threshold": 0.90,
    "max_candidates": 1,
    "embedding_dimensions": 1024
  },
  "directories": {
    "faq_dir": "faq_data",
    "cache_dir": "cache"
  },
  "logging": {
    "level": "INFO"
  },
  "matcher_weights": {
    "exact_match": 1.0,
    "cleaned_match": 0.95,
    "ngram_match": 0.4,
    "keyword_match": 0.7,
    "embedding": 0.8,
    "boost_factor": 0.15
  }
}
```

**Key Settings:**
- **confidence_threshold**: Minimum match score (0.9 = 90% confidence required)
- **embedding_model**: OpenAI model ("text-embedding-3-large" for best accuracy)
- **embedding_dimensions**: Vector dimensions (1024 for balanced performance)
- **matcher_weights**: Fine-tune hybrid matching algorithm components
- **directories**: FAQ data and cache locations
- **logging**: System log level (DEBUG, INFO, WARNING, ERROR)

## ЁЯУИ System Stats (this is subject to changes)

- **Total Collections**: 9 (one per FAQ domain)
- **Total Questions**: 338+ across all domains
- **Supported Languages**: Bengali (primary), English (fallback)
- **Embedding Dimensions**: 1024 (text-embedding-3-large)
- **RunTime Model**: gpt-4.1-nano

## ЁЯЫая╕П Requirements

- **Python**: 3.12
- **OpenAI API**: For embeddings
- **ChromaDB**: Vector storage
- **Dependencies**: Listed in `requirements.txt`

---

**** Deterministic RAG system for predefined Bengali FAQ systems**
